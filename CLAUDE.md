# CLAUDE.md - Keybox 開発ガイド

## プロジェクト概要

Keybox は Bash 製の軽量 CLI 鍵管理ツール。OpenSSL AES-256-CBC で暗号化した鍵を保存・取得する。

## ブランチ戦略

### ベースブランチ

- `develop` を開発のベースブランチとする
- すべての作業ブランチは `develop` から切る

### ブランチ命名規則

この環境では `claude/` 接頭辞とセッションID末尾が push の必須条件となる。
ブランチ名は英語の kebab-case で、指示内容を簡潔に表す名前にする。

**作業ブランチ（リモートに push する）:**

```
claude/{種別}/{説明}-{session}
```

| 種別 | 用途 | 例 |
|---|---|---|
| `feature` | 機能開発 | `claude/feature/import-keys-{session}` |
| `fix` | バグフィックス | `claude/fix/decryption-error-handling-{session}` |
| `dev` | 開発体制・ツール・テスト | `claude/dev/add-shellcheck-{session}` |
| `ci-cd` | デプロイ・CI/CD | `claude/ci-cd/github-actions-{session}` |
| `infra` | ホスティング・インフラ | `claude/infra/docker-setup-{session}` |

**プロトタイプブランチ（ローカル専用、push しない）:**

```
claude/{種別}/{説明}-proto-{n}
```

例: `claude/feature/import-keys-proto-1`, `claude/feature/import-keys-proto-2`

## 開発ワークフロー (プロトタイピング方式)

開発の指示を受けたら、以下の手順で進める。

### 1. 作業ブランチの作成

```
develop から作業ブランチを切る
例: claude/feature/import-keys-{session}
```

### 2. 3つのプロトタイプを並行作成

サブエージェントを **3つ** 起動し、それぞれ異なるアプローチでプロトタイプを実装する。

- 各プロトタイプはローカル専用ブランチで作業する（push しない）
  - `claude/feature/import-keys-proto-1`
  - `claude/feature/import-keys-proto-2`
  - `claude/feature/import-keys-proto-3`
- 各サブエージェントは独立してコードを書き、プロトタイプブランチにコミットする
- サブエージェントには以下を指示する:
  - 実装の方針・設計判断の要約をコミットメッセージまたは出力に含めること
  - 動作するコードを書くこと（スタブや TODO だけで終わらせない）

### 3. プロトタイプの比較・選定

3つのプロトタイプが完成したら、メインエージェントが以下を行う:

1. **各プロトタイプの diff を取得し比較する**
2. **最も良い実装を選定する**
   - 評価基準: コードの簡潔さ、既存コードとの一貫性、拡張性、エラーハンドリング
3. **設計構造に本質的な差異がある場合はユーザーに説明する**
   - 各プロトタイプの設計アプローチをコード片で示しながら違いを説明する
   - ユーザーの判断を仰ぐ
4. **細かな実装の差異（変数名、ループの書き方など）については最善と判断したものを採用してよい**
5. **選定した実装を作業ブランチ（サフィックスなし）にコミットする**
6. **ユーザーが特定のプロトタイプの詳細を見たい場合は、ローカルブランチから該当コードを会話上に表示する**

### 4. プロトタイプブランチの後始末

- ユーザーが選定結果を承認するまでプロトタイプブランチは削除しない
- 承認後、プロトタイプブランチ (`-proto-N`) をローカルから削除する

### 5. 選定結果の報告

ユーザーが選定結果を承認したら、エージェントは以下の内容を会話上で報告する。
PR の作成はユーザーが行う。

- **報告内容**: 何をどう変更したかの要約（PR 本文相当）
- **言語**: 英語と日本語の両方で書く
  1. まず英語で全体を書く
  2. その後に日本語訳を続けて書く
  3. 章ごとに英語→日本語と交互にするのではなく、英語ブロック全体の後に日本語ブロック全体を置く

```
## Summary
...
## Changes
...

---

## 概要
...
## 変更内容
...
```

## コーディング規約

- 既存コードのスタイルに合わせる（Bash スクリプト、インデントはスペース2つ）
- `keys/` ディレクトリには暗号化ファイルのみ格納。テストデータを含めない
- 新しい外部依存は最小限に抑える（OpenSSL と標準 Unix ツールの範囲を優先）
- セキュリティ上の機密データ（鍵、パスワード）をログやコミットに含めない
