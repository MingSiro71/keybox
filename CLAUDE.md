# CLAUDE.md - Keybox 開発ガイド

## プロジェクト概要

Keybox は Bash 製の軽量 CLI 鍵管理ツール。OpenSSL AES-256-CBC で暗号化した鍵を保存・取得する。

## ブランチ戦略

### ベースブランチ

`develop` を開発のベースブランチとする。

### ブランチ命名規則

`claude/` 接頭辞とセッションID末尾が push の必須条件。
ブランチ名は英語 kebab-case。

作業ブランチ（push する）: `claude/{種別}/{説明}-{session}`

| 種別 | 用途 |
|---|---|
| `feature` | 機能開発 |
| `fix` | バグフィックス |
| `dev` | 開発体制・ツール・テスト |
| `ci-cd` | デプロイ・CI/CD |
| `infra` | ホスティング・インフラ |

プロトタイプブランチ（ローカル専用）: `claude/{種別}/{説明}-proto-{n}`

## 開発ワークフロー (プロトタイピング方式)

### 1. 作業ブランチの作成

`develop` から作業ブランチを切る。

### 2. プロトタイプを並行作成

サブエージェントを3つ起動し、それぞれ異なるアプローチでプロトタイプを実装する。

- 各プロトタイプはローカル専用ブランチで作業する（push しない）
- サブエージェントには以下を指示する:
  - 実装の方針・設計判断の要約をコミットメッセージまたは出力に含めること
  - 動作するコードを書くこと（スタブや TODO だけで終わらせない）

### 3. プロトタイプの比較・選定

1. 各プロトタイプの diff を取得し比較する
2. 最も良い実装を選定する
   - 評価基準: コードの簡潔さ、既存コードとの一貫性、拡張性、エラーハンドリング
3. 設計構造に本質的な差異がある場合はコード片で示してユーザーの判断を仰ぐ
4. 細かな実装の差異（変数名、ループの書き方など）はエージェント判断で採用してよい
5. 選定した実装を作業ブランチにコミットする
6. ユーザーが特定のプロトタイプの詳細を見たい場合はローカルブランチから会話上に表示する

### 4. プロトタイプブランチの後始末

- ユーザーが選定結果を承認するまで削除しない
- 承認後に削除する

### 5. 選定結果の報告

変更内容の要約を日本語で報告する。PR の作成はユーザーが行う。

## 設計

- `bin/` : エントリポイント。shebang (`#!/bin/bash`) を持つ
- `lib/` : 機能モジュール。shebang なし、拡張子なし。`bin/` 内のスクリプトからサブプロセス実行される
- `keys/` : 暗号化された鍵ファイルの格納先。Git 管理外。テストデータを含めない

## コーディング規約

- インデント: スペース4つ
- 変数名: snake_case
- コマンド置換: `$()` を使用（バッククオートではなく）
- 変数展開: 文字列中では `${var}` を使い、単独では `$var`
- 標準のシェル文法で書く
- 新しい外部依存は最小限に抑える（OpenSSL と標準 Unix ツールの範囲を優先）
- セキュリティ上の機密データ（鍵、パスワード）をログやコミットに含めない
