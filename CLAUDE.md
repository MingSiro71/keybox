# CLAUDE.md - Keybox 開発ガイド

## プロジェクト概要

Keybox は Bash 製の軽量 CLI 鍵管理ツール。OpenSSL AES-256-CBC で暗号化した鍵を保存・取得する。

## ブランチ戦略

### ベースブランチ

- `develop` を開発のベースブランチとする
- すべての作業ブランチは `develop` から切る

### ブランチ命名規則

開発指示の内容に応じて以下の接頭辞を付けてブランチを作成する:

| 接頭辞 | 用途 | 例 |
|---|---|---|
| `feature/` | 機能開発 | `feature/import-keys` |
| `fix/` | バグフィックス | `fix/decryption-error-handling` |
| `dev/` | 開発体制・ツール・テスト | `dev/add-shellcheck` |
| `ci-cd/` | デプロイ・CI/CD | `ci-cd/github-actions` |
| `infra/` | ホスティング・インフラ | `infra/docker-setup` |

ブランチ名は英語の kebab-case で、指示内容を簡潔に表す名前にする。

## 開発ワークフロー (プロトタイピング方式)

開発の指示を受けたら、以下の手順で進める。

### 1. 作業ブランチの作成

```
develop から作業ブランチを切る
例: feature/import-keys
```

### 2. 3つのプロトタイプを並行作成

サブエージェントを **3つ** 起動し、それぞれ異なるアプローチでプロトタイプを実装する。

- 各プロトタイプは作業ブランチ名の末尾にサフィックスを付けたブランチで作業する
  - `feature/import-keys-proto-1`
  - `feature/import-keys-proto-2`
  - `feature/import-keys-proto-3`
- 各サブエージェントは独立してコードを書き、プロトタイプブランチにコミットする
- サブエージェントには以下を指示する:
  - 実装の方針・設計判断の要約をコミットメッセージまたは出力に含めること
  - 動作するコードを書くこと（スタブや TODO だけで終わらせない）

### 3. プロトタイプの比較・選定

3つのプロトタイプが完成したら、メインエージェントが以下を行う:

1. **各プロトタイプの diff を取得し比較する**
2. **最も良い実装を選定する**
   - 評価基準: コードの簡潔さ、既存コードとの一貫性、拡張性、エラーハンドリング
3. **設計構造に本質的な差異がある場合はユーザーに説明する**
   - 各プロトタイプの設計アプローチをコード片で示しながら違いを説明する
   - ユーザーの判断を仰ぐ
4. **細かな実装の差異（変数名、ループの書き方など）については最善と判断したものを採用してよい**
5. **選定した実装を作業ブランチ（サフィックスなし）にコミットする**

### 4. プロトタイプブランチの後始末

選定・コミット完了後、プロトタイプブランチ (`-proto-N`) はローカルから削除する。

## コーディング規約

- 既存コードのスタイルに合わせる（Bash スクリプト、インデントはスペース2つ）
- `keys/` ディレクトリには暗号化ファイルのみ格納。テストデータを含めない
- 新しい外部依存は最小限に抑える（OpenSSL と標準 Unix ツールの範囲を優先）
- セキュリティ上の機密データ（鍵、パスワード）をログやコミットに含めない
